<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>클래스 부트캠프 팀</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
      import {
        getFirestore,
        collection,
        getDocs,
        addDoc,
        where,
        query,
      } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-analytics.js";

      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      const firebaseConfig = {
        apiKey: "AIzaSyAUjCKERRTPH6kcmbW-cyEirSTW6SfivCQ",
        authDomain: "spartaminiproject-8c1e4.firebaseapp.com",
        projectId: "spartaminiproject-8c1e4",
        storageBucket: "spartaminiproject-8c1e4.firebasestorage.app",
        messagingSenderId: "1006694549228",
        appId: "1:1006694549228:web:c86739b1a0acdb96d547c9",
        measurementId: "G-92P7CY7JRK",
      };

      // Firebase 인스턴스 초기화
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const db = getFirestore(app);

      // DB에서 특정 팀원 정보 가져오기
      // let name = "";
      // let members = [];

      /**
       * 페이지가 로드되면 Firestore에서 팀원 정보를 가져와 슬라이더에 렌더링합니다.
       */
      document.addEventListener("DOMContentLoaded", async () => {
        const members = await fetchMembers();
        const selectedName = getNameFromHomeURL();
        getMember(selectedName, members);
        renderSlider(members);
      });

      /**
       * Firestore에서 팀원 정보를 가져옵니다.
       * @returns {Promise<Array>} 팀원 정보 배열
       */
      async function fetchMembers() {
        const qs = await getDocs(collection(db, "member"));
        const members = [];
        qs.forEach((doc) => {
          members.push(doc.data());
        });
        return members;
      }

      async function getMember(selectedName, members) {
        // javascript array 고차함수인 filter를 사용하여 name과 일치하는 팀원 정보 찾기
        const member = members.filter((doc) => doc.name === selectedName)[0];
        if (!member) {
          alert("멤버를 찾을 수 없습니다.");
          return;
        }

        // HTML 요소에 값 주입
        $("#member-img").attr("src", member.img);
        $("#member-name").text(member.name);
        $("#member-mbti").text(member.mbti);
        $("#member-greeting").text(member.title);
        $("#member-skillsHobbies").text(`${member.spec} / ${member.hobby}`);
        $("#member-strengthsWeaknesses").text(
          `${member.pros} / ${member.cons}`
        );
        $("#member-likesDislikes").text(`${member.like} / ${member.hate}`);
        $("#member-titleSong").text(member.song);
        // 블로그 링크 처리
        $("#member-blogUrl-container a")
          .attr("href", member.blog)
          .text(member.blog);
      }

      /**
       * 슬라이더에 팀원 정보를 렌더링합니다.
       * @param {Array} members - 팀원 정보 배열
       */
      function renderSlider(members) {
        const slider = document.getElementById("teamMemberSlider");
        slider.innerHTML = "";
        members.forEach((member) => {
          const item = document.createElement("div");
          item.className = "slider-item";
          item.innerHTML = `
            <img src="${member.img}" alt="${member.name}" class="slider-img" />
            <div class="slider-name">${member.name}</div>
            <div class="slider-role">${member.mbti}</div>
          `;

          // 클릭 이벤트 리스너 추가
          item.addEventListener("click", () => {
            getMember(member.name, members);
            history.replaceState(
              null,
              "",
              `?name=${encodeURIComponent(member.name)}`
            );
          });

          slider.appendChild(item);
        });
      }

      /**
       * URL에서 name 파라미터를 가져옵니다.
       * @returns {string} 이름
       */
      function getNameFromHomeURL() {
        const params = new URLSearchParams(window.location.search);
        return params.get("name") || "박신희"; // 기본값 설정
      }
    </script>
    <style>
      body {
        min-height: 100vh;
        background: #f8f9fa;
        margin: 0;
        font-family: "Pretendard", "Noto Sans KR", Arial, sans-serif;
        display: flex;
        flex-direction: column;
      }
      main {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .page-section {
        background: #fff;
        padding: 2rem 1rem;
        border-radius: 1.5rem;
        box-shadow: 0 2px 16px rgba(0, 0, 0, 0.07);
        margin: 2rem 0;
        width: 100%;
        max-width: 900px;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .display-5 {
        font-size: 2.2rem;
        font-weight: bold;
        color: #22223b;
        margin-bottom: 2rem;
        text-align: center;
      }
      .card {
        background: #fff;
        border-radius: 1.2rem;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        padding: 2rem;
        border: none;
        margin-bottom: 2rem;
      }
      .row {
        display: flex;
        flex-wrap: wrap;
        gap: 2rem;
        align-items: center;
      }
      .col-img {
        flex: 0 0 200px;
        text-align: center;
      }
      .col-info {
        flex: 1 1 300px;
      }
      .rounded-circle {
        border-radius: 50%;
      }
      .border-primary {
        border: 4px solid #4361ee;
      }
      .shadow-sm {
        box-shadow: 0 1px 6px rgba(67, 97, 238, 0.08);
      }
      .display-6 {
        font-size: 1.5rem;
        font-weight: bold;
        color: #4361ee;
        margin-bottom: 0.5rem;
      }
      .fs-5 {
        font-size: 1.1rem;
        color: #495057;
        font-weight: 600;
        margin-bottom: 1.5rem;
      }
      .info-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        margin-bottom: 1.5rem;
      }
      .info-card {
        background: #f8f9fa;
        border-radius: 0.8rem;
        padding: 1rem;
        min-height: 80px;
      }
      .fw-semibold {
        font-weight: 600;
      }
      .text-info {
        color: #4895ef;
        margin-bottom: 0.3rem;
      }
      .text-dark {
        color: #22223b;
      }
      .text-secondary {
        color: #868e96;
      }
      .link-primary {
        color: #4361ee;
        text-decoration: underline;
      }
      .mt-2 {
        margin-top: 0.5rem;
      }
      .mt-4 {
        margin-top: 1.5rem;
      }
      .mb-4 {
        margin-bottom: 1.5rem;
      }
      .mb-5 {
        margin-bottom: 2rem;
      }
      .fw-bold {
        font-weight: bold;
      }
      .fw-medium {
        font-weight: 500;
      }
      /* 슬라이더 */
      .slider-section {
        width: 100%;
        margin-bottom: 2rem;
        padding: 1.5rem;
        border: 1px solid #e9ecef;
        background: #f8f9fa;
        border-radius: 1rem;
      }
      .slider-title {
        font-size: 1.1rem;
        font-weight: bold;
        color: #22223b;
        margin-bottom: 1rem;
        text-align: center;
      }
      .slider {
        display: flex;
        overflow-x: auto;
        gap: 1.2rem;
        padding-bottom: 1rem;
        scrollbar-width: thin;
      }
      .slider::-webkit-scrollbar {
        height: 8px;
      }
      .slider::-webkit-scrollbar-thumb {
        background: #dee2e6;
        border-radius: 4px;
      }
      .slider-item {
        min-width: 120px;
        background: #fff;
        border-radius: 0.8rem;
        box-shadow: 0 1px 6px rgba(67, 97, 238, 0.07);
        padding: 1rem 0.5rem;
        text-align: center;
        cursor: pointer;
        transition: box-shadow 0.2s;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .slider-item:hover {
        box-shadow: 0 4px 16px rgba(67, 97, 238, 0.13);
      }
      .slider-img {
        width: 60px;
        height: 60px;
        object-fit: cover;
        border-radius: 50%;
        border: 2px solid #4895ef;
        margin-bottom: 0.5rem;
      }
      .slider-name {
        font-weight: bold;
        color: #22223b;
        margin-bottom: 0.2rem;
        font-size: 1rem;
      }
      .slider-role {
        color: #868e96;
        font-size: 0.95rem;
      }
      @media (max-width: 700px) {
        .page-section {
          padding: 1rem 0.2rem;
        }
        .card {
          padding: 1rem;
        }
        .row {
          flex-direction: column;
          gap: 1rem;
        }
        .info-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>

  <body>
    <main>
      <section class="page-section">
        <h2 class="display-5">팀원 소개</h2>
        <div
          id="teamMemberDetailSection"
          style="width: 100%; margin-bottom: 2rem"
        >
          <div id="memberDetailContainer" class="card">
            <div class="row">
              <div class="col-img">
                <img
                  id="member-img"
                  src="${img}"
                  alt=""
                  class="rounded-circle border-primary shadow-sm"
                  style="width: 200px; height: 200px; object-fit: cover"
                />
              </div>
              <div class="col-info">
                <h3 id="member-name" class="display-6"></h3>
                <p id="member-role" class="fs-5"></p>
                <div class="info-grid">
                  <div class="info-card">
                    <p class="fw-semibold text-info">MBTI</p>
                    <p class="text-dark" id="member-mbti"></p>
                  </div>
                  <div class="info-card">
                    <p class="fw-semibold text-info">한마디</p>
                    <p class="text-dark" id="member-greeting"></p>
                  </div>
                  <div class="info-card">
                    <p class="fw-semibold text-info">특기와 취미</p>
                    <p class="text-dark" id="member-skillsHobbies"></p>
                  </div>
                  <div class="info-card">
                    <p class="fw-semibold text-info">장점과 단점</p>
                    <p class="text-dark" id="member-strengthsWeaknesses"></p>
                  </div>
                  <div class="info-card">
                    <p class="fw-semibold text-info">
                      좋아하는 것과 싫어하는 것
                    </p>
                    <p class="text-dark" id="member-likesDislikes"></p>
                  </div>
                  <div class="info-card">
                    <p class="fw-semibold text-info">타이틀 노래</p>
                    <p class="text-dark" id="member-titleSong"></p>
                  </div>
                </div>
                <div id="member-blogUrl-container" class="text-secondary mt-4">
                  <strong class="fw-medium">개인 블로그: </strong>
                  <a
                    id="member-blogUrl"
                    href=""
                    target="_blank"
                    rel="noopener noreferrer"
                    class="link-primary"
                  ></a>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 팀원 슬라이더 섹션 -->
        <section class="slider-section">
          <h3 class="slider-title">다른 팀원 보기</h3>
          <div class="slider" id="teamMemberSlider">
            <!-- 팀원 슬라이더의 항목들은 동적으로 추가 -->
          </div>
        </section>
      </section>
    </main>
  </body>
</html>
